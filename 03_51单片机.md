# 51单片机

![image-20250512163956534](assets/image-20250512163956534.png)

ROM：用来存储程序的。

RAM：存数据的，掉电易失。

SFR：特殊功能寄存器。 

![image-20250512171109207](assets/image-20250512171109207.png)

## 单片机的内部结构：

![image-20250512171307895](assets/image-20250512171307895.png)

计算机的组成部分：运算器，控制器，存储器，io接口

CPU：运算器和控制器

存储器：ROM、RAM。（哈弗架构）

单片机按照**存储器架构**分类：

1. **哈佛架构（Harvard Architecture）**

- 特点：程序存储（ROM）与数据存储（RAM）物理分离，允许并行访问，提升执行效率。典型代表为8051系列单片机。
- 优势：避免总线争用，实时性更强，适合嵌入式控制场景（如电机控制、传感器数据处理）。

2. **冯·诺依曼架构（Von Neumann Architecture）**

- 特点：程序和数据共享同一存储空间，通过总线分时访问。结构简单但效率较低，常见于早期单片机或通用处理器。
- 应用：部分低端MCU和通用计算场景（如简单逻辑控制）。

io接口：

1.并行IO接口：4个并行IO接口

2.串行IO接口：

![image-20250512172437185](assets/image-20250512172437185.png)

![image-20250512174100408](assets/image-20250512174100408.png)

### 一、中央处理器（CPU）

#### 1. **运算器（ALU）**

- **功能**：执行算术（加减乘除）和逻辑运算（与或非）。

- 关联部件：

  - **ACC（累加器）**：存储运算结果，是ALU输入输出的核心寄存器。
  - **B寄存器**：辅助乘法/除法运算（如MUL AB指令中存储乘数）。
  - **PSW（程序状态字）**：标志位（如进位CY、溢出OV、奇偶校验P）反映运算状态。

  ![image-20250512174618647](assets/image-20250512174618647.png)

  ![image-20250512175011597](assets/image-20250512175011597.png)

  ![image-20250512175708542](assets/image-20250512175708542.png)

  

#### 2. **控制器**

- **指令寄存器**：暂存从ROM中取出的指令，解码后生成控制信号。
- **PC（program count程序计数器）**：16位寄存器，指向下一条待执行指令的ROM地址。
- **DPTR（数据指针）**：16位寄存器，用于访问外部存储器（如MOVX指令）。

![image-20250512175928156](assets/image-20250512175928156.png)



------



### 二、存储器结构（哈佛架构）

#### 1. **程序存储器（ROM）**

- **容量**：4KB（8051）至64KB（增强型）。

- **功能**：存储固化程序代码，通过**程序地址寄存器**寻址。

- 控制信号：

  - **PSEN**（程序存储使能）：读取外部ROM时激活。
  - **EA**（外部访问）：EA=0时强制使用外部ROM。

  ![image-20250512181335938](assets/image-20250512181335938.png)

  ![image-20250512181827088](assets/image-20250512181827088.png)

  ![image-20250512182655677](assets/image-20250512182655677.png)

  

#### 2. **数据存储器（RAM）**

- **容量**：128B（8051）至256B（增强型）。

- 结构：

  - **通用RAM**：00H~7FH，存放临时数据。

  ![image-20250512183132413](assets/image-20250512183132413.png)

  ![image-20250512183239465](assets/image-20250512183239465.png)

  ![image-20250512183708214](assets/image-20250512183708214.png)

![image-20250512183831958](assets/image-20250512183831958.png)

![image-20250512184039041](assets/image-20250512184039041.png)

![image-20250512184130487](assets/image-20250512184130487.png)

- **SFR（特殊功能寄存器）**：80H~FFH，控制硬件模块（如P0~P3端口、定时器、串口）。

![image-20250512203255009](assets/image-20250512203255009.png)

![image-20250512203622799](assets/image-20250512203622799.png)

![image-20250512203817549](assets/image-20250512203817549.png)

#### **注意：**

1.PC：虽然是特殊功能寄存器，但是不允许寻址。PC为双字节寄存器，但是不在80H~FFH范围内。

2.上表中，凡是地址能**被8整除**的寄存器都是**可位寻址**的寄存器。

![image-20250512204236468](assets/image-20250512204236468.png)

![image-20250512204314968](assets/image-20250512204314968.png)



- **地址管理**：通过**RAM地址寄存器**和**SP（堆栈指针）**实现数据存取。

------

### 三、I/O端口与总线

#### 1. **并行I/O端口（P0~P3）**

- 结构：
  - **锁存器**（如P0锁存器）：保存端口输出数据。
  - **驱动器**（如P0驱动器）：增强驱动能力（P0需外接上拉电阻）。
- 复用功能：
  - **P0**：外部存储器地址/数据总线复用。
  - **P3**：提供中断、串口等第二功能（如P3.0=RXD，P3.1=TXD）。

#### 2. **总线系统**

- **地址总线**：由P0（低8位）和P2（高8位）组成，寻址范围64KB。
- **数据总线**：通过P0分时复用传输数据。
- **控制总线**：ALE（地址锁存使能）、RD/WR（外部RAM读写）等。

------

### 四、定时与控制单元

#### 1. **振荡器与时钟**

- **电路**：外接晶振至XTAL1/XTAL2引脚（典型频率12MHz）。
- **分频**：时钟信号经12分频生成机器周期（1μs@12MHz）。

![image-20250512180302022](assets/image-20250512180302022.png)

![image-20250512180731664](assets/image-20250512180731664.png)



#### 2. **定时器/计数器**

- **结构**：包含TH0/TL0、TH1/TL1两个16位计数器，支持定时或外部脉冲计数。
- **控制**：通过TMOD（模式寄存器）、TCON（控制寄存器）配置。

#### 3. **中断系统**

- **中断源**：5个中断（2外部、2定时器、1串口）。
- **管理**：IE（中断使能）、IP（优先级）寄存器控制响应流程。

------

### 五、扩展功能设计

#### 1. **外部存储器扩展**

- **ROM扩展**：通过P0/P2和PSEN信号连接外部程序存储器。
- **RAM扩展**：使用P0/P2和RD/WR信号扩展数据存储空间。

#### 2. **复位与启动**

- **RESET电路**：高电平复位，初始化PC=0000H、SP=07H等寄存器。

------

### 六、典型工作流程（以指令执行为例）

1. **取指**：PC指向ROM地址→指令寄存器。
2. **译码**：指令寄存器→控制单元生成微操作信号。
3. **执行**：ALU运算（数据来自ACC/B寄存器）→结果写回RAM或端口。
4. **更新PC**：PC增量器根据指令长度（1~3字节）更新PC值。

------

### 七、设计特点与应用

- **哈佛架构优势**：程序与数据存储分离，避免总线冲突，提升实时性。
- **CISC指令集**：111条指令支持多种寻址方式，适合复杂控制逻辑。
- **典型应用**：工业控制（PLC）、家电（洗衣机控制板）、智能仪表等。

![image-20250512174224562](assets/image-20250512174224562.png)

## 单片机的外部引脚及片外总线

### 1.外部引脚

![image-20250512204647014](assets/image-20250512204647014.png)

![image-20250512210024007](assets/image-20250512210024007.png)

![image-20250512210115167](assets/image-20250512210115167.png)

![image-20250512210256666](assets/image-20250512210256666.png)

![image-20250512211327701](assets/image-20250512211327701.png)

![image-20250512211450870](assets/image-20250512211450870.png)

![image-20250512211558849](assets/image-20250512211558849.png)

## 单片机的时序

![image-20250512211741847](assets/image-20250512211741847.png)

上图可以知道，在一个机器周期里，可以读取两个指令。

现在的国产STC的51兼容单片机，已经不再12分频了，可以做到1T。也就是晶振周期即为机器周期，这样速度更快。

### 指令周期：

![image-20250512212909923](assets/image-20250512212909923.png)

#### 1.单机器周期指令（单字节）

![image-20250512213351664](assets/image-20250512213351664.png)

![image-20250512213435794](assets/image-20250512213435794.png)

#### 2.单机器周期指令（双字节）

![image-20250512213606593](assets/image-20250512213606593.png)

#### 3.双机器周期指令的时序（单字节）

![image-20250512213747239](assets/image-20250512213747239.png)

## 51单片机的工作方式

### 1.复位方式

![image-20250512214007861](assets/image-20250512214007861.png)

![image-20250512214449591](assets/image-20250512214449591.png)

### 2. 其他的工作方式

![image-20250512214549072](assets/image-20250512214549072.png)

# 单片机C语言：

 ![image-20250513083156149](assets/image-20250513083156149.png)

![image-20250513083243921](assets/image-20250513083243921.png)

## C51特有的数据类型：

![image-20250513083418675](assets/image-20250513083418675.png)